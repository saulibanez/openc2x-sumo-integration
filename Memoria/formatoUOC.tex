%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Paquetes
\usepackage[spanish,es-nolayout]{babel}
\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage{arev}
\usepackage{xcolor}
\usepackage{amsmath}
\usepackage{booktabs}
\usepackage{graphicx}
\usepackage[a4paper,left=3.5cm,right=2.0cm,top=1.2cm,
            headsep=3mm,headheight=2.3cm,includehead,
            footskip=15mm]{geometry}
\usepackage{float}
\usepackage{listings}
    \renewcommand{\lstlistingname}{Código}
\usepackage{setspace}
    \setstretch{1.15}
\usepackage{enumitem}
\usepackage[colorlinks,allcolors=.,breaklinks]{hyperref}
\usepackage{silence}

\WarningFilter{latexfont}{Font shape `TS1/fav/m/n' undefined}
\WarningFilter{latexfont}{Some font shapes were not available, defaults substituted.}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Colores
\color[HTML]{000078}
\definecolor{celeste}{HTML}{73EDFF}
\definecolor{gris}{HTML}{F0F0F0}


\makeatletter

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Encabezados y pies de página
\usepackage{fancyhdr}
    \fancyhf{}
    \renewcommand{\headrulewidth}{0pt}
    \fancyhead[L]{\hspace*{-2.5cm}
    \includegraphics[width=18cm]{images/encabezado.png}
    }
    \fancyfoot[R]{\footnotesize
    \begin{tabular}{@{}l@{}l@{}l@{}}
    \textcolor[HTML]{73EDFF}{\rule{6.7cm}{0.9mm}} &
    \textcolor[HTML]{73EDFF}{\rule{5.7cm}{0.9mm}} &
    \textcolor[HTML]{73EDFF}{\rule{2.7cm}{0.9mm}} \\
       \@autorcorto  & \@fecha & \textbf{\thepage}
    \end{tabular}
    }
\pagestyle{fancy}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Datos
\newcommand{\@asignatura}{}
\newcommand{\@titulo}{}
\newcommand{\@subtitulo}{}
\newcommand{\@autor}{}
\newcommand{\@autorcorto}{}
\newcommand{\@fecha}{\today}

\newcommand{\@programa}{}
\newcommand{\@areaTFM}{}
\newcommand{\@tutorTFM}{}
\newcommand{\@profeResp}{}

\newcommand{\asignatura}[1]{
    \renewcommand{\@asignatura}{#1}}
\newcommand{\titulo}[1]{
    \renewcommand{\@titulo}{#1}}
\newcommand{\subtitulo}[1]{
    \renewcommand{\@subtitulo}{#1}}
\newcommand{\autor}[2][]{\ifthenelse{\equal{#1}{}}
   {\renewcommand\@autorcorto{#2}\renewcommand\@autor{#2}}
   {\renewcommand\@autorcorto{#1}\renewcommand\@autor{#2}}}
\newcommand{\fecha}[1]{
    \renewcommand{\@fecha}{#1}}

\newcommand{\programa}[1]{
\renewcommand{\@programa}{#1}}
\newcommand{\areaTFM}[1]{
    \renewcommand{\@areaTFM}{#1}}
\newcommand{\tutorTFM}[1]{
    \renewcommand{\@tutorTFM}{#1}}
\newcommand{\profeResp}[1]{
    \renewcommand{\@profeResp}{#1}}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Portada
\newcommand{\portada}{
    \newgeometry{margin=12mm}
    \thispagestyle{empty}
    \noindent
    \fcolorbox{celeste}{celeste}{
    \begin{minipage}[t][10cm][t]{18.1cm}
    \flushleft
    \hspace{0pt}\\
    {\fontsize{35pt}{35pt}\selectfont \textbf{\@asignatura} \\}
    \vspace{\fill}
    {\fontsize{35pt}{35pt}\selectfont \@titulo \\[1cm]\hspace{0pt}}
    \end{minipage}
    }\\[9mm]

    \clearpage
    \restoregeometry

    \noindent
    \parbox{\linewidth}{\Huge\flushleft
    {\bfseries \@titulo}
    \ifthenelse{\equal{\@subtitulo}{}}{}{\\ \@subtitulo}\\[1cm]
    }

    \pagenumbering{gobble}
    \noindent
    \makebox[\linewidth][c]{%
        \includegraphics[width=6cm]{images/portada.png}
        \hspace{7mm}
        \fcolorbox{gris}{gris}{%
            \begin{minipage}[b][15.59cm][t]{11.2cm}
                \flushleft
                \hspace{0pt}\\
                \Huge
                \textbf{\@autor}\\[1cm]
                \LARGE
                \@programa\\
                \@areaTFM\\[1cm]
                \LARGE
                \textbf{Tutor de TF}\\
                \@tutorTFM\\
                \textbf{Profesor/a responsable de la asignatura}\\
                \@profeResp\\[1cm]
                \LARGE
                \@fecha
            \end{minipage}
        }
    }
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Bibliografía
\usepackage[babel]{csquotes}
%\usepackage[style=apa,backend=biber]{biblatex}
\usepackage[style=numeric,sorting=none,backend=biber]{biblatex}

    \DeclareLanguageMapping{spanish}{spanish-apa}
    
    \DefineBibliographyStrings{spanish}{%
      andothers = {et al\adddot},
    }
    
    \DefineBibliographyExtras{spanish}
        {\setcounter{smartand}{1}% or some other value
         \let\lbx@finalnamedelim=\lbx@es@smartand
         \let\lbx@finallistdelim=\lbx@es@smartand}
    
    \setlength{\bibhang}{\parindent}  

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Leyendas
\usepackage[font={small},labelfont={bf,small},
  justification=centerlast,tablename=Tabla]{caption}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Código

\definecolor{codegreen}{rgb}{0,0.6,0}
\definecolor{codegray}{rgb}{0.5,0.5,0.5}
\definecolor{codepurple}{rgb}{0.58,0,0.82}

\lstdefinestyle{mystyle}{
    backgroundcolor=\color{celeste!20},   
    commentstyle=\color{codegreen},
    keywordstyle=\color{magenta},
    numberstyle=\tiny\color{codegray},
    stringstyle=\color{codepurple},
    basicstyle=\ttfamily\footnotesize,
    breakatwhitespace=false,         
    breaklines=true,                 
    captionpos=b,                    
    keepspaces=true,                 
    numbers=left,                    
    numbersep=5pt,                  
    showspaces=false,                
    showstringspaces=false,
    showtabs=false,                  
    tabsize=2,
    linewidth=0.98\linewidth,
    xleftmargin=0.5cm
}

\lstset{style=mystyle}


\makeatother